% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/gp_enrich_multinet.R
\name{gp_enrich_multinet}
\alias{gp_enrich_multinet}
\title{Functional enrichment with g:Profiler for multilayer networks}
\usage{
gp_enrich_multinet(
  net,
  organism = "hsapiens",
  sources = c("GO:BP", "GO:MF", "GO:CC", "REAC"),
  layer_order = NULL,
  significant = TRUE,
  user_threshold = 0.05,
  correction_method = c("g_SCS", "fdr", "bonferroni", "none"),
  exclude_iea = FALSE,
  domain_scope = c("annotated", "custom"),
  custom_bg = NULL,
  show_terms = 10,
  results_dir = getOption("mlnet.results_dir", "omicsDNA_results"),
  run_name = NULL,
  per_layer_subdirs = TRUE,
  format = c("png", "pdf", "jpg"),
  width = 9,
  height = 7,
  dpi = 300,
  show_in_rstudio = TRUE,
  verbose = TRUE,
  ton_show = TRUE,
  ton_top_terms = 10,
  ton_min_overlap = 1,
  ton_layout = "fr",
  ton_width = width,
  ton_height = height,
  ton_margin_cm = c(0.5, 0.5, 0.5, 0.5),
  communities = NULL,
  enrich_scope = c("layer", "community"),
  restrict_genes = NULL,
  min_query_size = 3
)
}
\arguments{
\item{net}{A \pkg{multinet} object.}

\item{organism}{Organism string accepted by g:Profiler (e.g. "hsapiens").}

\item{sources}{Character vector of g:Profiler sources (e.g. c("GO:BP","REAC")).}

\item{layer_order}{Optional character vector of layers to process (and order).}

\item{significant}{Logical; if TRUE, apply a p-value threshold:
for standard corrections this is handled by g:Profiler;
for \code{correction_method = "none"} it is applied to \code{p_raw}.}

\item{user_threshold}{Numeric significance threshold.}

\item{correction_method}{One of "g_SCS", "fdr", "bonferroni", or "none".
See Details for behaviour of "none".}

\item{exclude_iea}{Logical; exclude electronic annotations?}

\item{domain_scope}{"annotated" or "custom" (with \code{custom_bg}).}

\item{custom_bg}{Optional background genes (symbols), used when
\code{domain_scope = "custom"}.}

\item{show_terms}{Number of top terms (by p-value) for dot plot and concept net.}

\item{results_dir}{Base output directory.}

\item{run_name}{Optional subfolder name under \code{results_dir}; if NULL a
timestamped name is generated.}

\item{per_layer_subdirs}{Logical; if TRUE (default) create a subdirectory per
layer under the run directory.}

\item{format}{Plot format: "png", "pdf", or "jpg".}

\item{width, height, dpi}{Plot geometry (inches; DPI ignored for PDF).}

\item{show_in_rstudio}{Logical; print plots to current device.}

\item{verbose}{Logical; print progress messages.}

\item{ton_show}{Logical; draw term-only network?}

\item{ton_top_terms}{Number of top terms to include in term-only network.}

\item{ton_min_overlap}{Minimum shared genes between terms to draw an edge.}

\item{ton_layout}{Layout for term-only network ("fr","kk","lgl","mds").}

\item{ton_width, ton_height}{Size (inches) for term-only network.}

\item{ton_margin_cm}{Vector c(top,right,bottom,left) in cm for term-only plot.}

\item{communities}{Optional data.frame describing communities.}

\item{enrich_scope}{"layer" (default) or "community".}

\item{restrict_genes}{Optional character vector; if non-NULL, each query
gene set is restricted to its intersection with this vector.}

\item{min_query_size}{Minimum number of genes in a query to run g:Profiler.}
}
\value{
Invisibly, a list with:
\describe{
\item{\code{run_dir}}{Absolute path to the run folder.}
\item{\code{by_layer}}{Layer-keyed list. For layer-scope, each element
contains file paths and \code{n_genes}/\code{n_terms}. For community-
scope, each layer contains a list keyed by community ID (e.g. "cid_C1").}
\item{\code{summary_file}}{Path to run-level \code{SUMMARY.csv}.}
}
}
\description{
For each selected layer (and optionally each community in each layer), this
function:
\enumerate{
\item extracts gene symbols (from vertex names or community memberships);
\item optionally restricts them to a user-supplied gene set
(\code{restrict_genes});
\item runs \strong{g:Profiler} (\code{\link[gprofiler2]{gost}}) using the
requested sources;
\item saves a \strong{CSV} with results, including a plain-text
\code{intersection_genes} column and simple enrichment metrics;
\item saves a \strong{gost} dot plot of significant terms;
\item saves a \strong{term–gene concept network};
\item saves a \strong{term-only overlap network}.
}

In \strong{layer scope}, the output structure is conserved:
\preformatted{
  <results_dir>/<run_name>/
    <layer>/
      gprof_<layer>.csv
      gprof_dot_<layer>.<format>
      gprof_cnet_<layer>.<format>
      gprof_termnet_<layer>.<format>
    SUMMARY.csv
}

In \strong{community scope}, results are nested inside each layer:
\preformatted{
  <results_dir>/<run_name>/
    <layer>/
      cid_<CID>/
        gprof_<layer>_cid<CID>.csv
        gprof_dot_<layer>_cid<CID>.<format>
        gprof_cnet_<layer>_cid<CID>.<format>
        gprof_termnet_<layer>_cid<CID>.<format>
    SUMMARY.csv
}
}
\details{
g:Profiler enrichment for multilayer networks (layer- or community-wise)

\strong{Inputs.}
Layers are read from \code{multinet::layers_ml(net)} and converted to
\pkg{igraph}s via \code{as.list(net)} (vertex names = gene symbols).

\strong{Scopes.}
\itemize{
\item \code{enrich_scope = "layer"} (default): one query per layer
(vertex set of the layer, optionally restricted by \code{restrict_genes}).
\item \code{enrich_scope = "community"}: one query per community per layer,
as defined by \code{communities} (\code{actor}, \code{layer}, \code{cid}).
}

\strong{Communities.} \code{communities} should be a data.frame with at least:
\itemize{
\item an \emph{actor} column (gene symbol / actor ID);
\item a \emph{layer} column (matching \code{multinet::layers_ml(net)});
\item a community column. The function normalises this to \code{cid} using:
\code{cid}, \code{com}, or \code{community} (in that order).
}

\strong{Custom query restriction.}
If \code{restrict_genes} is non-\code{NULL}, the query set for each layer
(or community) is intersected with this vector before calling g:Profiler.
Only communities/layers with at least \code{min_query_size} genes after
restriction are tested.

\strong{Statistics.}
G:Profiler returns adjusted p-values using \code{correction_method}:
\code{"g_SCS"}, \code{"fdr"} (Benjamini–Hochberg FDR), or \code{"bonferroni"}.
The threshold is given by \code{user_threshold}.

Additionally, this function supports \code{correction_method = "none"}:
\itemize{
\item g:Profiler is called without significance filtering;
\item raw hypergeometric p-values (\code{p_raw}) are computed from
\code{effective_domain_size}, \code{term_size},
\code{query_size}, and \code{intersection_size};
\item if \code{significant = TRUE}, terms are kept only when
\code{p_raw <= user_threshold};
\item CSVs include an extra \code{p_raw} column, and ranking/plots
use \code{p_raw}.
}

The result CSV also contains:
\itemize{
\item \code{intersection_genes} — semicolon-separated gene symbols;
\item \code{precision = intersection_size / query_size};
\item \code{recall    = intersection_size / term_size}.
}
}
