% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/add_network_attributes.R
\name{add_network_attributes}
\alias{add_network_attributes}
\title{Attach node (actor) and edge attributes to a multilayer network, with match reporting}
\usage{
add_network_attributes(
  net,
  nodesMetadata = NULL,
  featureID_col = "feature_id",
  nodeAttrCols = NULL,
  fillMissingNodes = TRUE,
  nodeFillValue = "Unknown",
  actor_key_fun = NULL,
  actor_key_normalize = NULL,
  auto_detect_keys = TRUE,
  min_match_warn = 0.7,
  report_n_examples = 10,
  map_edges_by_actor_key = TRUE,
  edgesMetadata = NULL,
  edge_from = "from",
  edge_to = "to",
  edge_layer_col = NULL,
  edgeAttrCols = NULL,
  edgeAggregate = c("first", "mean", "median", "sum"),
  directed_network = FALSE,
  fillMissingEdges = FALSE,
  edgeFillValue = NA,
  overwrite_existing = TRUE,
  verbose = TRUE,
  results_dir = getOption("mlnet.results_dir", "omicsDNA_results"),
  save_report = TRUE,
  export_edge_join_csv = FALSE,
  edge_join_prefix = "edge_attributes_join"
)
}
\arguments{
\item{net}{A \code{multinet::ml.network} object to which attributes will be attached.}

\item{nodesMetadata}{Optional data frame of actor (node) metadata.}

\item{featureID_col}{Column name in \code{nodesMetadata} containing the actor identifier used for
matching (default \code{"feature_id"}).}

\item{nodeAttrCols}{Columns from \code{nodesMetadata} to attach as actor attributes. If \code{NULL},
all columns except \code{featureID_col} are attached.}

\item{fillMissingNodes}{Logical; if \code{TRUE}, missing node attributes are filled using
\code{nodeFillValue}.}

\item{nodeFillValue}{Fill value used when \code{fillMissingNodes = TRUE}.}

\item{actor_key_fun}{Optional function that transforms IDs before matching (overrides
\code{actor_key_normalize}).}

\item{actor_key_normalize}{Optional character vector of built-in normalisation steps applied to IDs
before matching (e.g., \code{c("strip_version","trim","tolower")}).}

\item{auto_detect_keys}{Logical; if \code{TRUE}, the function tests multiple normalisation recipes and
uses the one that yields the highest match coverage.}

\item{min_match_warn}{If match coverage is below this fraction, the function prints examples of
unmatched actors.}

\item{report_n_examples}{Maximum number of unmatched actor examples to show in messages/reports.}

\item{map_edges_by_actor_key}{Logical; if \code{TRUE}, edge endpoints in \code{edgesMetadata} are
normalised/mapped using the actor key logic before joining to network edges.}

\item{edgesMetadata}{Optional edge metadata, either a data frame (with endpoints + layer column) or a
named list of per-layer data frames.}

\item{edge_from, edge_to}{Column names for endpoints in \code{edgesMetadata}.}

\item{edge_layer_col}{Layer column name for data-frame \code{edgesMetadata}. If \code{NULL}, common
names are auto-detected.}

\item{edgeAttrCols}{Edge metadata columns to attach. If \code{NULL}, all columns except endpoints and
(when present) the layer column are attached.}

\item{edgeAggregate}{How to combine duplicate metadata rows for the same edge. One of
\code{"first"}, \code{"mean"}, \code{"median"}, \code{"sum"}.}

\item{directed_network}{Logical; controls whether edges are treated as directed or undirected when
matching edge metadata.}

\item{fillMissingEdges}{Logical; if \code{TRUE}, missing edge attribute values are filled before
attachment.}

\item{edgeFillValue}{Fill value used when \code{fillMissingEdges = TRUE}.}

\item{overwrite_existing}{Logical; if \code{FALSE}, existing attributes are not re-declared, though
values for specified actors/edges may still be set.}

\item{verbose}{Logical; print progress messages and file locations.}

\item{results_dir}{Output directory for reports and optional debug CSV.}

\item{save_report}{Logical; if \code{TRUE}, write the RDS and TXT report files to \code{results_dir}.}

\item{export_edge_join_csv}{Logical; if \code{TRUE}, export the final edge join table as CSV for debugging.}

\item{edge_join_prefix}{Prefix used for the edge join CSV filename.}
}
\value{
The modified \code{multinet::ml.network} (returned invisibly). The object also receives two
attached R attributes:
\describe{
\item{\code{attr(net, "actor_match_report")}}{Summary of actor matching coverage and unmatched examples.}
\item{\code{attr(net, "edge_attach_report")}}{Summary of edge-attribute attachment and dropped rows.}
}
}
\description{
Adds external metadata to an existing multilayer network (\code{multinet::ml.network}).
The function can attach:
\itemize{
\item \strong{actor (node) attributes} from \code{nodesMetadata}, and/or
\item \strong{edge attributes} from \code{edgesMetadata}.
}
It is designed to be robust to common identifier formatting issues (e.g., case differences,
version suffixes, punctuation) by supporting simple ID normalisation steps and an optional
auto-detection procedure that selects the normalisation strategy with the highest match coverage.
A compact report of match rates and attached attributes can be saved to disk.
}
\details{
\section{What is the input to this function?}{
The main input is an existing \code{multinet::ml.network} object (\code{net}).

Actor attributes are supplied via \code{nodesMetadata}, a data frame in which
\code{nodesMetadata[[featureID_col]]} contains the IDs that should match actors in the network.

Edge attributes are supplied via \code{edgesMetadata}, which can be either:
\itemize{
\item a \strong{data frame} containing \code{from}, \code{to}, a layer column, and attribute columns; or
\item a \strong{named list} of per-layer data frames (one data frame per layer).
}
If \code{map_edges_by_actor_key = TRUE}, edge endpoints in \code{edgesMetadata} are first mapped to
network actors using the same ID key logic used for node matching.
}

\section{How matching and attachment are performed (simple overview)}{
\enumerate{
\item \strong{Extract network structure:} edges and actors are read from \code{net}. If the network
provides two layer columns (\code{layer1}, \code{layer2}), only intra-layer edges are used
for attachment (\code{layer1 == layer2}).
\item \strong{Match actors:} when \code{nodesMetadata} is provided, actor IDs are normalised
(via \code{actor_key_fun} or \code{actor_key_normalize}) and matched to metadata IDs. When
\code{auto_detect_keys = TRUE}, multiple normalisation recipes are tried and the best
(highest coverage) is selected.
\item \strong{Attach actor attributes:} selected columns (\code{nodeAttrCols}) are stored as actor
attributes in the multilayer network; missing values can be filled when
\code{fillMissingNodes = TRUE}.
\item \strong{Attach edge attributes:} when \code{edgesMetadata} is provided, endpoints are mapped
to network actors, unmappable rows are dropped, and duplicate rows per edge are aggregated
(controlled by \code{edgeAggregate}). For undirected networks, endpoints are canonicalised so
\code{A–B} and \code{B–A} map to the same edge.
\item \strong{Report:} a concise summary is attached to the returned object and can be saved to disk.
}
}

\section{What files does this function write?}{
File outputs are optional and controlled by \code{save_report} and \code{export_edge_join_csv}.
When enabled, files are written under \code{results_dir}:
\itemize{
\item \strong{Report (machine-readable):} \code{addattrs_report_<timestamp>.rds}
\item \strong{Report (human-readable):} \code{addattrs_report_<timestamp>.txt}
\item \strong{Optional edge-join table (debugging):} if \code{export_edge_join_csv = TRUE},
the final edge join table is saved as \code{<edge_join_prefix>_<timestamp>.csv}.
}
If \code{save_report = FALSE} and \code{export_edge_join_csv = FALSE}, the function writes no files.
}
}
